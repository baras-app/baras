---
phase: 05-frontend-error-handling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/components/toast.rs
  - app/src/components/mod.rs
  - app/src/app.rs
  - app/assets/styles.css
autonomous: true

must_haves:
  truths:
    - "Toast notifications can be shown from any component"
    - "Toasts auto-dismiss after 5-7 seconds"
    - "Toasts can be manually dismissed with X button"
    - "Toasts appear in bottom-right corner"
  artifacts:
    - path: "app/src/components/toast.rs"
      provides: "Toast component and ToastManager"
      exports: ["Toast", "ToastSeverity", "ToastManager", "ToastFrame", "use_toast_provider", "use_toast"]
    - path: "app/assets/styles.css"
      provides: "Toast container and item styles"
      contains: ".toast-container"
  key_links:
    - from: "app/src/app.rs"
      to: "app/src/components/toast.rs"
      via: "use_toast_provider() at app root"
      pattern: "use_toast_provider"
---

<objective>
Create toast notification infrastructure for displaying error messages to users.

Purpose: Establishes the foundation for graceful error display. All subsequent plans will use this toast system to show errors from failed API calls.

Output: ToastManager context provider, Toast component, and CSS styles for bottom-right toast notifications.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-error-handling/05-CONTEXT.md
@.planning/phases/05-frontend-error-handling/05-RESEARCH.md
@app/src/app.rs
@app/src/components/mod.rs
@app/assets/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create toast component and manager</name>
  <files>app/src/components/toast.rs, app/src/components/mod.rs</files>
  <action>
Create `app/src/components/toast.rs` with:

1. `ToastSeverity` enum: `Normal`, `Critical` (Copy, Clone, PartialEq, Eq)

2. `Toast` struct (Clone):
   - `id: u32`
   - `message: String`
   - `severity: ToastSeverity`

3. `ToastManager` struct (Clone, Copy) with:
   - `toasts: Signal<Vec<Toast>>`
   - `next_id: Signal<u32>`

4. `ToastManager` impl:
   - `fn new() -> Self` - creates signals
   - `fn show(&self, message: impl Into<String>, severity: ToastSeverity)`:
     - Get and increment next_id
     - Push toast to vec
     - spawn async with gloo_timers::future::TimeoutFuture for auto-dismiss (5000ms Normal, 7000ms Critical)
     - Cap at 5 toasts max, remove oldest if exceeded
   - `fn dismiss(&self, id: u32)` - remove by id

5. Provider functions:
   - `pub fn use_toast_provider() -> ToastManager` - wraps use_context_provider(ToastManager::new)
   - `pub fn use_toast() -> ToastManager` - wraps use_context::<ToastManager>()

6. `#[component] pub fn ToastFrame() -> Element`:
   - Get manager via use_toast()
   - Render `.toast-container` div
   - For each toast: render with severity class, message, dismiss button
   - Use warning icon (fa-triangle-exclamation)

Update `app/src/components/mod.rs`:
- Add `pub mod toast;`
- Add `pub use toast::{ToastFrame, ToastManager, ToastSeverity, use_toast, use_toast_provider};`

Use gloo_timers (already in Cargo.toml) for TimeoutFuture.
  </action>
  <verify>
Compile check: `cd /home/prescott/baras/app && cargo check --target wasm32-unknown-unknown 2>&1 | head -50`
Should compile without errors.
  </verify>
  <done>Toast module exports ToastManager, ToastFrame, use_toast_provider, use_toast. No compilation errors.</done>
</task>

<task type="auto">
  <name>Task 2: Add toast CSS styles</name>
  <files>app/assets/styles.css</files>
  <action>
Append toast styles to `app/assets/styles.css`:

```css
/* Toast Notifications */
.toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
    pointer-events: none;
}

.toast {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--color-surface, #1e1e2e);
    border: 1px solid var(--color-warning, #f9a825);
    border-radius: 8px;
    color: var(--color-text, #e0e0e0);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    animation: toast-slide-in 0.3s ease-out;
    pointer-events: auto;
}

.toast-critical {
    border-color: var(--color-error, #ef5350);
    background: rgba(239, 83, 80, 0.1);
}

.toast-icon {
    color: var(--color-warning, #f9a825);
    flex-shrink: 0;
}

.toast-critical .toast-icon {
    color: var(--color-error, #ef5350);
}

.toast-message {
    flex: 1;
    font-size: 14px;
    line-height: 1.4;
}

.toast-close {
    background: none;
    border: none;
    color: var(--color-text-muted, #888);
    cursor: pointer;
    padding: 4px 8px;
    font-size: 14px;
    opacity: 0.7;
    transition: opacity 0.2s;
    flex-shrink: 0;
}

.toast-close:hover {
    opacity: 1;
}

@keyframes toast-slide-in {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
```

Find appropriate location (end of file or near modal styles) and add the block.
  </action>
  <verify>
File contains toast styles: `grep -c "toast-container" /home/prescott/baras/app/assets/styles.css` returns 1
  </verify>
  <done>Toast CSS styles added to styles.css including container, item, animation, and severity variants.</done>
</task>

<task type="auto">
  <name>Task 3: Wire toast provider to app root</name>
  <files>app/src/app.rs</files>
  <action>
Update `app/src/app.rs`:

1. Add import at top (with other component imports):
   ```rust
   use crate::components::{ToastFrame, use_toast_provider};
   ```

2. In `App()` function, near the start (before any component that might need toasts):
   ```rust
   // Initialize toast system at app root
   let _toast_manager = use_toast_provider();
   ```

3. In the rsx! block, add ToastFrame just before the closing `}` of the main element:
   ```rust
   // At end of main content, before closing brace
   ToastFrame {}
   ```

Place ToastFrame at the end of the `main { class: "container", ... }` block so it renders on top.
  </action>
  <verify>
Compile check: `cd /home/prescott/baras/app && cargo check --target wasm32-unknown-unknown 2>&1 | head -50`
Should compile. ToastFrame rendered in app.
  </verify>
  <done>Toast provider initialized at app root, ToastFrame rendered in main layout. App compiles successfully.</done>
</task>

</tasks>

<verification>
1. `cd /home/prescott/baras/app && cargo check --target wasm32-unknown-unknown` - compiles without errors
2. Toast module exists with expected exports
3. CSS contains toast styles
4. App.rs initializes toast provider and renders ToastFrame
</verification>

<success_criteria>
- Toast system compiles and integrates with existing app
- ToastManager can be accessed from any component via use_toast()
- ToastFrame renders in app layout
- CSS provides proper styling for bottom-right positioned toasts
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-error-handling/05-01-SUMMARY.md`
</output>
