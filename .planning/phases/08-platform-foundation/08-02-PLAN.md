---
phase: 08-platform-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/app.rs
  - app/assets/styles.css
  - app/src/components/effect_editor.rs
autonomous: true

must_haves:
  truths:
    - "BARAS header renders correctly on Windows without missing glyphs"
    - "Alacrity/Latency fields appear on session page near player info"
    - "Alacrity/Latency fields have explanatory tooltips"
    - "Alacrity/Latency fields are editable inline"
  artifacts:
    - path: "app/src/app.rs"
      provides: "Font-face with font-display and PlayerStatsBar on session page"
      contains: "font-display"
    - path: "app/src/app.rs"
      provides: "PlayerStatsBar component rendered in session tab"
      contains: "PlayerStatsBar"
    - path: "app/assets/styles.css"
      provides: "Styling for player-stats-bar in session context"
      contains: "player-stats-bar"
  key_links:
    - from: "app/src/app.rs (session tab)"
      to: "PlayerStatsBar component"
      via: "RSX render call"
      pattern: "PlayerStatsBar"
---

<objective>
Fix Windows font rendering and relocate Alacrity/Latency fields to the session page.

Purpose: Ensure cross-platform visual consistency and make player stats more discoverable.
Output: Working StarJedi font on Windows, Alacrity/Latency inputs on session page with tooltips.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-platform-foundation/08-RESEARCH.md
@.planning/phases/08-platform-foundation/08-CONTEXT.md

@app/src/app.rs
@app/assets/styles.css
@app/src/components/effect_editor.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Windows font rendering</name>
  <files>app/src/app.rs, app/assets/styles.css</files>
  <action>
The StarJedi font works on Linux but fails on Windows WebView2. Apply standard cross-platform font fixes:

1. In app/src/app.rs line 324, enhance the @font-face rule:
   FROM:
   ```rust
   style { "@font-face {{ font-family: 'StarJedi'; src: url('{FONT}') format('truetype'); }}" }
   ```
   TO:
   ```rust
   style { "@font-face {{ font-family: 'StarJedi'; src: url('{FONT}') format('truetype'); font-display: block; font-weight: normal; font-style: normal; }}" }
   ```

   The `font-display: block` tells the browser to block text rendering briefly while the font loads, rather than showing fallback then swapping. This is more reliable in WebView2.

2. In app/assets/styles.css line 219, ensure the font stack is correct:
   ```css
   font-family: "StarJedi", "Segoe UI", Arial, sans-serif;
   ```
   Adding Segoe UI provides a Windows-friendly fallback while the custom font loads.

If the font still doesn't work after these changes, the issue may require deeper WebView2 investigation (noted for future).
  </action>
  <verify>
Build and run on Windows (or have user test): BARAS header should display in StarJedi font.
Build and run on Linux: Verify no regression (font still works).
  </verify>
  <done>
Font-face declaration includes font-display: block.
Font fallback stack includes Windows-friendly fonts.
Header text renders correctly on both platforms.
  </done>
</task>

<task type="auto">
  <name>Task 2: Move PlayerStatsBar to session page</name>
  <files>app/src/app.rs, app/src/components/effect_editor.rs, app/assets/styles.css</files>
  <action>
Move Alacrity/Latency fields from Effects tab to Session page as per user decision in CONTEXT.md.

1. Copy the PlayerStatsBar component from app/src/components/effect_editor.rs (lines 234-298) to app/src/app.rs:
   - Place it near other local components (around line 1400+)
   - Add tooltips to the inputs as specified in CONTEXT.md:
     - Alacrity: title: "Your alacrity percentage for GCD calculations"
     - Latency: title: "Your network latency in milliseconds for ability timing"

2. In app/src/app.rs session tab section (around line 651, after the session-grid div closes):
   Add the PlayerStatsBar component:
   ```rust
   // After the session-grid closing div (line 651)
   PlayerStatsBar {}
   ```

3. Remove the PlayerStatsBar component from app/src/components/effect_editor.rs:
   - Delete lines 230-298 (the component and its section header comment)
   - Verify the EffectEditorPanel still compiles without it

4. Update app/assets/styles.css to ensure player-stats-bar styling works in session context:
   - The existing .player-stats-bar styles should work, but verify they're not scoped to effects-panel
   - If needed, adjust margins for session page context (less padding since it's not in a tabbed panel)

The PlayerStatsBar should appear below the session-grid, showing the editable Alacrity % and Latency (ms) fields.
  </action>
  <verify>
Run `dx serve` and navigate to Session tab.
Verify Alacrity and Latency inputs appear below the session info grid.
Verify hovering over inputs shows tooltip text.
Verify changing values saves correctly (check config).
Navigate to Effects tab - verify PlayerStatsBar is NOT there anymore.
  </verify>
  <done>
PlayerStatsBar appears on Session page below player info.
Both fields have explanatory tooltips on hover.
Fields are editable and save to config.
Component removed from Effects tab.
Covers requirements PLAT-02 and PLAT-04.
  </done>
</task>

</tasks>

<verification>
1. Build check: `cargo check -p app` and `dx build` pass
2. Font rendering: BARAS header visible on Windows (user verification if needed)
3. Session page: Alacrity/Latency fields visible below session grid
4. Tooltips: Hover shows explanatory text
5. Editing: Values save and persist
</verification>

<success_criteria>
- StarJedi font renders on Windows (or graceful fallback)
- Alacrity/Latency moved from Effects to Session page
- Both fields have tooltips explaining their purpose
- Fields remain editable with config persistence
- Covers requirements PLAT-02 and PLAT-04
</success_criteria>

<output>
After completion, create `.planning/phases/08-platform-foundation/08-02-SUMMARY.md`
</output>
