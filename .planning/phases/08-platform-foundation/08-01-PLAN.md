---
phase: 08-platform-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src-tauri/Cargo.toml
  - app/src-tauri/src/lib.rs
  - app/src/app.rs
autonomous: true

must_haves:
  truths:
    - "User cannot launch second app instance (gets focus redirect)"
    - "Existing window focuses and unminimizes when second instance attempted"
    - "Hotkey settings page clearly explains Wayland/Linux limitations"
  artifacts:
    - path: "app/src-tauri/Cargo.toml"
      provides: "tauri-plugin-single-instance dependency"
      contains: "tauri-plugin-single-instance"
    - path: "app/src-tauri/src/lib.rs"
      provides: "Single instance plugin registration"
      contains: "tauri_plugin_single_instance"
    - path: "app/src/app.rs"
      provides: "Enhanced hotkey limitation warning"
      contains: "Wayland"
  key_links:
    - from: "app/src-tauri/src/lib.rs"
      to: "tauri_plugin_single_instance"
      via: "plugin registration as FIRST plugin"
      pattern: "\\.plugin\\(tauri_plugin_single_instance"
---

<objective>
Implement single instance enforcement and enhance hotkey limitation documentation.

Purpose: Prevent user confusion from multiple app instances and clarify platform limitations for hotkeys.
Output: Single instance enforcement via Tauri plugin, enhanced hotkey settings warning text.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-platform-foundation/08-RESEARCH.md

@app/src-tauri/src/lib.rs
@app/src-tauri/Cargo.toml
@app/src-tauri/src/tray.rs
@app/src/app.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add single instance plugin</name>
  <files>app/src-tauri/Cargo.toml, app/src-tauri/src/lib.rs</files>
  <action>
1. Add dependency to app/src-tauri/Cargo.toml:
   ```toml
   [target.'cfg(desktop)'.dependencies]
   tauri-plugin-single-instance = "2"
   ```
   Add this in the existing target-specific dependencies section (after line 53).

2. In app/src-tauri/src/lib.rs, register the single-instance plugin as the FIRST plugin:
   - Add the plugin BEFORE tauri_plugin_updater (line 61)
   - Use the callback pattern from tray.rs for consistency:
   ```rust
   .plugin(tauri_plugin_single_instance::init(|app, _args, _cwd| {
       // Focus existing window when second instance attempts to launch
       if let Some(window) = app.get_webview_window("main") {
           let _ = window.show();
           let _ = window.unminimize();
           let _ = window.set_focus();
       }
   }))
   ```

CRITICAL: The single-instance plugin MUST be the first plugin registered. This ensures it checks for existing instances before any other initialization occurs.
  </action>
  <verify>
Run `cargo check -p app` in the app/src-tauri directory to verify compilation.
Launch app, then try launching a second instance - first window should focus.
  </verify>
  <done>
Second instance attempts focus existing window instead of opening new instance.
Plugin is registered first in the builder chain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance hotkey limitation warning</name>
  <files>app/src/app.rs</files>
  <action>
Update the hotkey settings section (lines 1158-1205) to provide clearer platform limitation explanation:

1. Replace the existing hint on line 1160:
   FROM: `p { class: "hint", "Format: Ctrl+Shift+Key (Windows only)" }`
   TO: Include a more prominent warning about Linux/Wayland:

```rust
p { class: "hint", "Format: Ctrl+Shift+Key" }
p { class: "hint hint-warning",
    i { class: "fa-solid fa-triangle-exclamation" }
    " Global hotkeys are Windows-only. Linux and Wayland do not support global hotkeys due to security restrictions."
}
```

2. Keep the existing "Restart app after changes" warning (line 1161-1164).

The styling for hint-warning already exists in the codebase (uses yellow/orange styling).
  </action>
  <verify>
Run `dx serve` and navigate to General Settings > Global Hotkeys section.
Verify the warning text is visible and explains the Linux/Wayland limitation.
  </verify>
  <done>
Hotkey settings page shows clear warning about Linux/Wayland not supporting global hotkeys.
Warning appears before user attempts to configure hotkeys.
  </done>
</task>

</tasks>

<verification>
1. Build check: `cargo check -p app` passes
2. Single instance: Launch app twice, second attempt focuses first window
3. Hotkey UI: Settings modal shows Linux/Wayland limitation warning
</verification>

<success_criteria>
- Single instance plugin compiles and is registered first
- Second app launch attempt focuses existing window (not opens new)
- Hotkey settings clearly state Linux/Wayland limitation
- Covers requirements PLAT-01 and PLAT-03
</success_criteria>

<output>
After completion, create `.planning/phases/08-platform-foundation/08-01-SUMMARY.md`
</output>
