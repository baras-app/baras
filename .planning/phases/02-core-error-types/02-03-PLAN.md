---
phase: 02-core-error-types
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - core/src/context/error.rs
  - core/src/context/mod.rs
  - core/src/timers/error.rs
  - core/src/timers/mod.rs
  - core/src/timers/preferences.rs
autonomous: true

must_haves:
  truths:
    - "context module has typed error enums for config and file watching"
    - "timers module has typed error enum and PreferencesError uses thiserror"
  artifacts:
    - path: "core/src/context/error.rs"
      provides: "WatcherError, ConfigError enums"
      exports: ["WatcherError", "ConfigError"]
    - path: "core/src/timers/error.rs"
      provides: "TimerError enum"
      exports: ["TimerError"]
    - path: "core/src/timers/preferences.rs"
      provides: "PreferencesError with thiserror derive"
      contains: "#[derive(Debug, Error)]"
  key_links:
    - from: "core/src/timers/preferences.rs"
      to: "thiserror"
      via: "derive macro"
      pattern: "#\\[derive.*Error\\]"
    - from: "core/src/context/error.rs"
      to: "confy::ConfyError"
      via: "#[from] conversion"
      pattern: "Confy.*#\\[from\\]"
---

<objective>
Create error types for context and timers modules (orchestration/feature modules).

Purpose: These modules handle configuration, file watching, and timer operations. The timers module already has a manually-implemented PreferencesError that should be converted to thiserror.

Output:
- core/src/context/error.rs with WatcherError, ConfigError
- core/src/timers/error.rs with TimerError
- core/src/timers/preferences.rs PreferencesError converted to thiserror
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-error-types/02-RESEARCH.md
@core/src/context/mod.rs
@core/src/context/watcher.rs
@core/src/context/config.rs
@core/src/timers/mod.rs
@core/src/timers/preferences.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create context error types</name>
  <files>core/src/context/error.rs, core/src/context/mod.rs</files>
  <action>
Create `core/src/context/error.rs` with error types for configuration and file watching:

```rust
//! Error types for context operations

use std::path::PathBuf;
use thiserror::Error;

/// Errors during directory watching and indexing
#[derive(Debug, Error)]
pub enum WatcherError {
    #[error("failed to read directory {path}")]
    ReadDir {
        path: PathBuf,
        #[source]
        source: std::io::Error,
    },

    #[error("failed to read file metadata for {path}")]
    Metadata {
        path: PathBuf,
        #[source]
        source: std::io::Error,
    },

    #[error("failed to initialize file watcher")]
    InitWatcher(#[source] notify::Error),

    #[error("failed to watch path {path}")]
    WatchPath {
        path: PathBuf,
        #[source]
        source: notify::Error,
    },

    #[error("no log files found in {path}")]
    NoLogFiles { path: PathBuf },
}

/// Errors during configuration operations
#[derive(Debug, Error)]
pub enum ConfigError {
    #[error("failed to load configuration")]
    Load(#[from] confy::ConfyError),

    #[error("failed to save configuration")]
    Save(#[source] confy::ConfyError),

    #[error("profile '{name}' not found")]
    ProfileNotFound { name: String },

    #[error("maximum profiles reached ({max})")]
    MaxProfilesReached { max: usize },

    #[error("profile name '{name}' already exists")]
    ProfileNameTaken { name: String },

    #[error("failed to create config directory")]
    CreateDir(#[source] std::io::Error),
}
```

Update `core/src/context/mod.rs` to:
1. Add `pub mod error;`
2. Re-export: `pub use error::{WatcherError, ConfigError};`
  </action>
  <verify>`cargo check -p baras-core` succeeds</verify>
  <done>WatcherError and ConfigError are defined and exported from context module</done>
</task>

<task type="auto">
  <name>Task 2: Create timers error types and convert PreferencesError</name>
  <files>core/src/timers/error.rs, core/src/timers/mod.rs, core/src/timers/preferences.rs</files>
  <action>
Create `core/src/timers/error.rs` with error types for timer operations:

```rust
//! Error types for timer operations

use std::path::PathBuf;
use thiserror::Error;

/// Errors during timer definition loading
#[derive(Debug, Error)]
pub enum TimerError {
    #[error("failed to read timer file {path}")]
    ReadFile {
        path: PathBuf,
        #[source]
        source: std::io::Error,
    },

    #[error("failed to parse timer TOML in {path}")]
    ParseToml {
        path: PathBuf,
        #[source]
        source: toml::de::Error,
    },

    #[error("failed to read timer directory {path}")]
    ReadDir {
        path: PathBuf,
        #[source]
        source: std::io::Error,
    },

    #[error("invalid timer definition in {path}: {reason}")]
    InvalidDefinition { path: PathBuf, reason: String },
}
```

Update `core/src/timers/preferences.rs` to use thiserror for PreferencesError:

Replace the manual error implementation (lines ~235-252) with:

```rust
use thiserror::Error;

/// Errors during timer preferences operations
#[derive(Debug, Error)]
pub enum PreferencesError {
    #[error("IO error at {0}")]
    Io(PathBuf, #[source] std::io::Error),

    #[error("parse error in {0}")]
    Parse(PathBuf, #[source] toml::de::Error),

    #[error("serialization error")]
    Serialize(#[from] toml::ser::Error),
}
```

Remove the manual `impl std::fmt::Display` and `impl std::error::Error` blocks.

Update `core/src/timers/mod.rs` to:
1. Add `pub mod error;`
2. Re-export: `pub use error::TimerError;`
3. Keep existing PreferencesError re-export from preferences.rs
  </action>
  <verify>`cargo check -p baras-core` succeeds</verify>
  <done>TimerError is defined, PreferencesError uses thiserror, both exported from timers module</done>
</task>

</tasks>

<verification>
After all tasks:
1. `cargo check -p baras-core` passes
2. Error types are properly exported:
   - `baras_core::context::WatcherError`
   - `baras_core::context::ConfigError`
   - `baras_core::timers::TimerError`
   - `baras_core::timers::PreferencesError` (now with thiserror)
3. PreferencesError no longer has manual Display/Error impls
</verification>

<success_criteria>
- context/error.rs exists with WatcherError and ConfigError enums
- timers/error.rs exists with TimerError enum
- PreferencesError in preferences.rs uses #[derive(Debug, Error)] from thiserror
- Manual Display and Error impls removed from PreferencesError
- All error types include context fields (paths, profile names)
- Module mod.rs files export the error types
- `cargo check -p baras-core` passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-error-types/02-03-SUMMARY.md`
</output>
