---
phase: 04-backend-error-handling
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src-tauri/src/tray.rs
autonomous: true

must_haves:
  truths:
    - "Missing default window icon does not crash tray setup"
    - "Tray setup propagates error instead of panicking"
    - "Application starts normally when icon is available"
  artifacts:
    - path: "app/src-tauri/src/tray.rs"
      provides: "Safe tray icon handling with error propagation"
      contains: "ok_or"
  key_links:
    - from: "app/src-tauri/src/tray.rs"
      to: "TrayIconBuilder"
      via: "error propagation with ?"
      pattern: "ok_or.*\\?"
---

<objective>
Convert tray icon unwrap to error propagation.

Purpose: Prevent application crash if default window icon is missing during tray setup.
Output: Tray setup returns descriptive error instead of panicking on missing icon.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-backend-error-handling/04-CONTEXT.md
@.planning/phases/04-backend-error-handling/04-RESEARCH.md

@app/src-tauri/src/tray.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert tray icon unwrap to error propagation</name>
  <files>app/src-tauri/src/tray.rs</files>
  <action>
Replace the .unwrap() on line 35 with error propagation:

**Line 35** (in setup_tray):
```rust
// Before
.icon(app.default_window_icon().unwrap().clone())

// After
.icon(
    app.default_window_icon()
        .ok_or("No default window icon available")?
        .clone()
)
```

Why propagate error instead of fallback:
- setup_tray already returns Result<(), Box<dyn std::error::Error>>
- A missing icon indicates a build/packaging problem
- Better to surface the error than silently continue with no icon
- The error message is clear and actionable for debugging

The function signature is already:
```rust
pub fn setup_tray<R: Runtime>(app: &AppHandle<R>) -> Result<(), Box<dyn std::error::Error>>
```

So the ? operator works directly - the string error will convert to Box<dyn Error>.
  </action>
  <verify>
Run: `grep -n "\.unwrap()" app/src-tauri/src/tray.rs` - should return no matches
Run: `grep -n "ok_or" app/src-tauri/src/tray.rs` - should return 1 match at the icon line
Run: `cargo check -p baras-app` - should compile without errors
  </verify>
  <done>
Zero .unwrap() calls in tray.rs. Missing icon returns descriptive error.
  </done>
</task>

</tasks>

<verification>
After completion:
- `grep -rn "\.unwrap()" app/src-tauri/src/tray.rs` returns nothing
- `cargo check -p baras-app` compiles cleanly
- setup_tray returns error instead of panicking when icon missing
</verification>

<success_criteria>
- tray.rs has zero .unwrap() calls
- Icon access uses ok_or with descriptive error message
- Error propagates via ? to caller
- Code compiles without warnings
</success_criteria>

<output>
After completion, create `.planning/phases/04-backend-error-handling/04-03-SUMMARY.md`
</output>
