---
phase: 16-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - overlay/Cargo.toml
autonomous: true

must_haves:
  truths:
    - "cocoa crate is not in dependency tree"
    - "objc crate (0.2) is not in dependency tree"
    - "core-graphics crate is still present"
    - "macOS overlay compiles without errors"
  artifacts:
    - path: "overlay/Cargo.toml"
      provides: "Clean macOS dependencies"
      contains: "core-graphics"
      not_contains: ["cocoa", "objc = "]
  key_links:
    - from: "overlay/Cargo.toml"
      to: "objc2 ecosystem"
      via: "Platform dependencies"
      pattern: "objc2"
---

<objective>
Remove deprecated `cocoa` and `objc` crate dependencies from the overlay crate after Phase 15's objc2 migration.

Purpose: Complete the macOS support milestone by eliminating deprecated dependencies, leaving a clean dependency tree with only modern, maintained crates.
Output: Updated overlay/Cargo.toml without cocoa or objc crates, verified to build successfully.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-cleanup/16-RESEARCH.md
@overlay/Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove deprecated cocoa and objc dependencies</name>
  <files>overlay/Cargo.toml</files>
  <action>
Remove the `cocoa` and `objc` lines from the macOS platform dependencies section:

In `overlay/Cargo.toml`, locate the section:
```toml
# Platform: macOS
[target.'cfg(target_os = "macos")'.dependencies]
cocoa = "0.26"
core-graphics = "0.24"
objc = "0.2"
```

Remove ONLY these two lines:
- `cocoa = "0.26"`
- `objc = "0.2"`

Keep `core-graphics = "0.24"` - it is independent and still needed for CGContext operations.

The resulting macOS section should have:
- `core-graphics = "0.24"` (retained)
- Plus the objc2 ecosystem dependencies added by Phase 15 (objc2, objc2-foundation, objc2-app-kit)

Do NOT use `cargo remove` - manual edit is more precise and allows adding a clarifying comment.
  </action>
  <verify>
Verify with grep that cocoa and objc are removed:
```bash
grep -E "^cocoa|^objc = " overlay/Cargo.toml
# Should return empty (no matches)

grep "core-graphics" overlay/Cargo.toml
# Should show: core-graphics = "0.24"
```
  </verify>
  <done>
cocoa and objc lines removed from overlay/Cargo.toml. core-graphics retained.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify macOS build and clean dependency tree</name>
  <files></files>
  <action>
Run verification commands to confirm:
1. The macOS overlay compiles without errors
2. The deprecated crates are completely removed from the dependency tree
3. core-graphics is still present

Commands to run:
```bash
# 1. Check compilation (cross-compile check from any platform)
cargo check -p baras-overlay --target aarch64-apple-darwin

# 2. Verify cocoa and objc are gone from dependency tree
# Use regex that matches "objc " (with space) to avoid matching objc2
cargo tree -p baras-overlay --target aarch64-apple-darwin 2>&1 | grep -E "(cocoa|objc[^2])"
# Expected: no output (empty)

# 3. Verify core-graphics is still present
cargo tree -p baras-overlay --target aarch64-apple-darwin 2>&1 | grep "core-graphics"
# Expected: shows core-graphics v0.24.x

# 4. Verify objc2 ecosystem is present (confirms Phase 15 deps)
cargo tree -p baras-overlay --target aarch64-apple-darwin 2>&1 | grep "objc2"
# Expected: shows objc2, objc2-foundation, objc2-app-kit
```

If cargo check fails with missing imports, Phase 15 migration is incomplete - do NOT proceed with cleanup.
  </action>
  <verify>
All verification commands pass:
- cargo check completes without errors
- No cocoa or objc (0.2) in dependency tree
- core-graphics present
- objc2 ecosystem present
  </verify>
  <done>
macOS overlay builds successfully with clean dependency tree containing only modern crates.
  </done>
</task>

</tasks>

<verification>
Phase 16 verification checklist:

1. **Dependency removal**: `grep -E "^cocoa|^objc = " overlay/Cargo.toml` returns empty
2. **Build success**: `cargo check -p baras-overlay --target aarch64-apple-darwin` completes without errors
3. **Clean tree**: `cargo tree -p baras-overlay --target aarch64-apple-darwin | grep -E "(cocoa|objc[^2])"` returns empty
4. **Core deps retained**: `cargo tree` shows core-graphics and objc2 ecosystem
</verification>

<success_criteria>
- [ ] `cocoa` crate removed from overlay/Cargo.toml
- [ ] `objc` crate removed from overlay/Cargo.toml
- [ ] `core-graphics` crate retained in overlay/Cargo.toml
- [ ] `cargo check --target aarch64-apple-darwin` passes
- [ ] Dependency tree contains no deprecated crates
- [ ] MAC-06 requirement satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/16-cleanup/16-01-SUMMARY.md`
</output>
