---
phase: 09-session-page-polish
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - app/src/app.rs
  - app/assets/styles.css
autonomous: true

must_haves:
  truths:
    - "User sees 'No Active Session' when no log file is being watched"
    - "User sees 'Waiting for character...' when log file detected but no character data"
    - "User sees character name when character has logged in"
    - "Historical session shows end time and duration prominently"
    - "Historical session hides Area, Class, and Discipline"
    - "Live session shows green play icon indicator"
    - "Historical session shows amber pause icon indicator"
    - "User can upload to Parsely directly from session page"
  artifacts:
    - path: "app/src/app.rs"
      provides: "Session panel with empty states, historical display, indicators, upload button"
      min_lines: 100
    - path: "app/assets/styles.css"
      provides: "Styles for session indicators and upload button"
      contains: "session-indicator"
  key_links:
    - from: "app/src/app.rs"
      to: "/api/session_info"
      via: "api::get_session_info() call"
      pattern: "get_session_info"
    - from: "app/src/app.rs"
      to: "/api/upload_to_parsely"
      via: "api::upload_to_parsely() call"
      pattern: "upload_to_parsely"
---

<objective>
Frontend session page polish with empty states, historical display improvements, indicators, and Parsely upload

Purpose: Session page shows helpful states and relevant information without noise
Output: Polished session panel with clear empty states, better historical display, live/historical indicators, and direct Parsely upload access
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-session-page-polish/09-CONTEXT.md
@.planning/phases/09-session-page-polish/09-RESEARCH.md
@.planning/phases/09-session-page-polish/09-01-SUMMARY.md

Key context:
- Session panel is in app.rs around lines 603-659
- is_live_tailing signal already exists and is reactive
- session signal contains SessionInfo (now enhanced with session_end, duration_formatted from Plan 01)
- active_file signal has the path string for Parsely upload
- Toast system available via use_toast()
- Font Awesome icons available (fa-play, fa-pause, fa-upload)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement empty state messaging</name>
  <files>
    - app/src/app.rs
  </files>
  <action>
In the session tab section (around line 603), modify the conditional rendering to handle three states:

1. **No Active Session** - when session is None AND watching is false:
   - Show: "No Active Session"
   - Hint: "Start SWTOR to begin logging"
   - Use empty state pattern from history_panel.rs (fa-inbox icon, hint text)

2. **Waiting for character...** - when session is None AND watching is true:
   - Show: "Waiting for character..."
   - Hint: "Log file detected, waiting for character login"
   - Use fa-hourglass-half icon

3. **Character name** - when session is Some with player_name:
   - Continue to existing session panel display
   - This is the current behavior, no changes needed

Add a new `watching` signal if not already present - fetch via api::get_watching_status().
The signal should update on session-updated events.

Pattern reference from history_panel.rs lines 232-237:
```rust
div { class: "history-empty",
    i { class: "fa-solid fa-inbox" }
    p { "No encounters yet" }
    p { class: "hint", "Encounters will appear here as combat occurs" }
}
```

Use similar structure but with class "session-empty" for the empty states.
  </action>
  <verify>
cargo check -p app --lib
  </verify>
  <done>
Session page shows "No Active Session" when not watching, "Waiting for character..." when watching but no session, character name when session exists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement historical session display and indicators</name>
  <files>
    - app/src/app.rs
    - app/assets/styles.css
  </files>
  <action>
Modify the session panel to differentiate live vs historical sessions:

**For the session header (h3 element):**
Replace the simple "Live Session" / "Historical Session" text with an indicator icon + text:
```rust
if is_live_tailing() {
    h3 { class: "session-header",
        span { class: "session-indicator live",
            i { class: "fa-solid fa-play" }
        }
        " Live Session"
    }
} else {
    h3 { class: "session-header",
        span { class: "session-indicator historical",
            i { class: "fa-solid fa-pause" }
        }
        " Historical Session"
    }
}
```

**For historical sessions only:**
1. Show session_end and duration_formatted from the enhanced SessionInfo:
   - Add a "Duration" item showing duration_formatted
   - Modify "Started" to also show "Ended" time
2. Hide Area, Class, and Discipline items (wrap in `if is_live_tailing()`)
3. Add subtle background tint: add class "historical" to session-panel when !is_live_tailing()

**CSS additions in styles.css:**
```css
/* Session indicators */
.session-indicator {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.2em;
  height: 1.2em;
  border-radius: 50%;
  margin-right: 0.5em;
  font-size: 0.7em;
}

.session-indicator.live {
  background: var(--swtor-green);
  color: var(--background-primary);
}

.session-indicator.historical {
  background: var(--swtor-yellow);
  color: var(--background-primary);
}

/* Historical session panel tint */
.session-panel.historical {
  background: linear-gradient(135deg, rgba(255, 170, 0, 0.05) 0%, var(--background-tertiary) 100%);
  border-color: var(--swtor-yellow-dim);
}
```

**Session grid modifications for historical:**
- Show: Player (character name), Started, Ended, Duration, Combat
- Hide: Area, Class, Discipline
  </action>
  <verify>
cargo check -p app --lib
  </verify>
  <done>
Live sessions show green play indicator, historical sessions show amber pause indicator with subtle background tint, historical sessions hide Area/Class/Discipline and show end time + duration.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Parsely upload button to session header</name>
  <files>
    - app/src/app.rs
    - app/assets/styles.css
  </files>
  <action>
Add a Parsely upload button to the session panel for both live and historical sessions.

**In app.rs, inside the session-panel section:**
Add an upload button next to the header or in a toolbar row:
```rust
div { class: "session-toolbar",
    // ... existing header ...
    if let Some(ref file) = active_file() {
        button {
            class: "btn btn-session-upload",
            title: "Upload to Parsely",
            onclick: {
                let path = file.clone();
                move |_| {
                    let p = path.clone();
                    let mut toast = use_toast();
                    spawn(async move {
                        match api::upload_to_parsely(&p).await {
                            Ok(resp) if resp.success => {
                                if let Some(link) = resp.link {
                                    toast.show(format!("Uploaded! {}", link), ToastSeverity::Normal);
                                } else {
                                    toast.show("Upload successful", ToastSeverity::Normal);
                                }
                            }
                            Ok(resp) => {
                                let err = resp.error.unwrap_or_else(|| "Upload failed".to_string());
                                toast.show(format!("Upload failed: {}", err), ToastSeverity::Normal);
                            }
                            Err(e) => {
                                toast.show(format!("Upload error: {}", e), ToastSeverity::Critical);
                            }
                        }
                    });
                }
            },
            i { class: "fa-solid fa-cloud-arrow-up" }
            " Upload to Parsely"
        }
    }
}
```

Note: active_file is already a signal in app.rs scope - use it directly (no prop passing needed).

**CSS for upload button:**
```css
.session-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5em;
}

.btn-session-upload {
  display: inline-flex;
  align-items: center;
  gap: 0.4em;
  padding: 0.4em 0.8em;
  font-size: 0.85em;
  background: var(--blue-alpha-8);
  border: 1px solid var(--blue-alpha-20);
  border-radius: var(--radius-md);
  color: var(--swtor-blue);
  cursor: pointer;
  transition: all 0.2s;
}

.btn-session-upload:hover {
  background: var(--blue-alpha-20);
  border-color: var(--swtor-blue);
}

.btn-session-upload i {
  font-size: 1.1em;
}
```

Per CONTEXT.md: Click behavior is immediate upload (no confirmation dialog), feedback via toast notification.
  </action>
  <verify>
cargo check -p app --lib
  </verify>
  <done>
Session page has a Parsely upload button that uploads immediately on click and shows toast feedback with result/link.
  </done>
</task>

</tasks>

<verification>
1. Frontend compiles: `cargo check -p app --lib`
2. Manual testing:
   - Empty state shows when no file watched
   - "Waiting for character..." shows when file detected but no character
   - Session info shows when character logged in
   - Live session has green play indicator
   - Historical session has amber pause indicator, subtle tint, shows duration, hides Area/Class/Discipline
   - Upload button visible and functional
</verification>

<success_criteria>
- EMPTY-01: User sees helpful empty state messages based on watching/session state
- SESS-01: Historical session shows end time and total duration prominently
- SESS-02: Historical session hides Area, Class, and Discipline
- SESS-03: Live vs historical clearly distinguished by colored icons
- NAV-04: User can upload to Parsely directly from session page with toast feedback
</success_criteria>

<output>
After completion, create `.planning/phases/09-session-page-polish/09-02-SUMMARY.md`
</output>
