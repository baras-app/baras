# ═══════════════════════════════════════════════════════════════════════════════
# The Dread Fortress - Operation
# ═══════════════════════════════════════════════════════════════════════════════
# Dread Fortress - 5 boss operation (Nefra, Draxus, Grob'thok, Corruptor Zero, Brontes)
# Source: ORBS timer data + manual verification from NiM logs

[area]
name = "The Dread Fortress"
id = 137438993402

# ═══════════════════════════════════════════════════════════════════════════════
# Boss 1: Nefra, Who Bars the Way
# ═══════════════════════════════════════════════════════════════════════════════
# Simple boss with periodic raid damage and add spawns.
# Key mechanics:
# - Voice of the Masters: Raid-wide damage that must be healed through
# - DPS/Tank Adds: Spawned periodically, must be killed quickly
# - Twin Attack: Main rotation ability (used for NiM cleave tracking)
# - Nightmare Twin Attack: Special cleave mechanic in NiM

[[boss]]
id = "nefra"
name = "Nefra, Who Bars the Way"
difficulties = ["story", "veteran", "master"]

[[boss.entities]]
name = "Nefra, Who Bars the Way"
ids = [3266533082005504, 3303036009054208, 3303031714086912, 3303040304021504]
is_boss = true
is_kill_target = true

# ─── Counters ───────────────────────────────────────────────────────────────────
# NiM uses Twin Attack count to determine when adds/cleave happen

[[boss.counters]]
id = "nefra_twin_attack_count"
name = "Twin Attacks"
increment_on = { type = "ability_cast", abilities = [3342034312101888] }
reset_on = { type = "ability_cast", abilities = [
  3342167456088064,
] } # Reset on Nightmare Twin Attack

[[boss.counters]]
id = "nefra_rng_add_gate"
name = "rng_add_gate"
decrement_on = { type = "any_of", conditions = [
  { type = "timer_started", timer_id = "nefra_dps_add" },
  { type = "timer_started", timer_id = "nefra_tank_add" },
] }
increment_on = { type = "timer_expires", timer_id = "nefra_rng_add" }
initial_value = 0
# ─── Timers ─────────────────────────────────────────────────────────────────────

# -- Voice of the Masters --
# Raid-wide damage that needs to be healed. First at 15s, then every 30s.

[[boss.timer]]
id = "nefra_voice_cs"
name = "Voice"
trigger = { type = "combat_start" }
duration_secs = 15.0
color = [29, 153, 20, 255]
difficulties = ["veteran", "master"]
chains_to = "nefra_voice"

[[boss.timer]]
id = "nefra_voice"
name = "Voice"
trigger = { type = "ability_cast", abilities = [3270007710547968] }
duration_secs = 30.0
color = [29, 153, 20, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "nefra_dps_add_1st"
name = "DPS Add 1st"
display_text = "DPS Add"
trigger = { type = "combat_start" }
duration_secs = 30.0
color = [37, 219, 213, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "nefra_tank_add_1st"
name = "TANK Add 1st"
display_text = "Tank Add"
trigger = { type = "combat_start" }
duration_secs = 45.0
color = [52, 28, 219, 255]
difficulties = ["veteran"]

[[boss.timer]]
id = "nefra_dps_add_vm"
name = "DPS Add VM"
display_text = "DPS Add"
trigger = { type = "ability_cast", abilities = [3308460552749056] }
duration_secs = 30.0
color = [32, 211, 219, 255]
difficulties = ["veteran"]

[[boss.timer]]
id = "nefra_tank_add_vm"
name = "TANK Add VM"
display_text = "Tank Add"
trigger = { type = "ability_cast", abilities = [3308164200005632] }
duration_secs = 30.0
color = [46, 32, 219, 255]
difficulties = ["veteran"]

[[boss.timer]]
id = "nefra_tank_add"
name = "TANK Add NiM"
display_text = "Tank Add"
trigger = { type = "ability_cast", abilities = [3308460552749056] }
duration_secs = 10.0
color = [33, 29, 224, 255]
difficulties = ["master"]
counter_condition = { counter_id = "nefra_rng_add_gate", operator = "eq", value = 1 }

[[boss.timer]]
id = "nefra_dps_add"
name = "DPS Add NiM"
display_text = "Tank Add"
trigger = { type = "ability_cast", abilities = [3308164200005632] }
duration_secs = 10.0
color = [32, 219, 213, 255]
difficulties = ["master"]
counter_condition = { counter_id = "nefra_rng_add_gate", operator = "eq", value = 1 }

[[boss.timer]]
id = "nefra_rng_add"
name = "RNG Add"
trigger = { type = "ability_cast", abilities = [3342034312101888] }
duration_secs = 30.0
color = [33, 149, 224, 255]
difficulties = ["master"]
counter_condition = { counter_id = "nefra_twin_attack_count", operator = "eq", value = 12 }

[[boss.timer]]
id = "nefra_raid_cleave"
name = "Raid Cleave"
trigger = { type = "ability_cast", abilities = [3342034312101888] }
is_alert = true
alert_text = "Raid Cleave"
color = [219, 37, 41, 255]
difficulties = ["master"]
counter_condition = { counter_id = "nefra_twin_attack_count", operator = "eq", value = 15 }


# ═══════════════════════════════════════════════════════════════════════════════
# Boss 2: Gate Commander Draxus
# ═══════════════════════════════════════════════════════════════════════════════

[[boss]]
id = "draxus"
name = "Gate Commander Draxus"
difficulties = ["story", "veteran", "master"]

[[boss.entities]]
name = "Draxus"
ids = [3273924720721920, 3303401081274368, 3303392491339776, 3303405376241664]
is_boss = true
is_kill_target = true

[[boss.entities]]
name = "Subteroth"
ids = [3281320654405632]
is_boss = false

[[boss.entities]]
name = "Dispatcher"
ids = [3288141062471680]
is_boss = false

[[boss.entities]]
name = "Corrupter"
ids = [3288136767504384]
is_boss = false

[[boss.entities]]
name = "Dismantler"
ids = [3288029393321984, 3281329244340224]
is_boss = false


# ═════ Counters

[[boss.counters]]
id = "draxus_subteroth_count"
name = "Subteroth Spawns"
increment_on = { type = "npc_appears", selector = ["Subteroth"] }

[[boss.counters]]
id = "draxus_dispatcher_count"
name = "Dispatcher Spawns"
increment_on = { type = "npc_appears", selector = ["Dispatcher"] }

[[boss.counters]]
id = "draxus_corrupter_count"
name = "Corrupter Spawns"
increment_on = { type = "npc_appears", selector = ["Corrupter"] }

[[boss.counters]]
id = "draxus_dismantler_count"
name = "Dismantler Spawns"
increment_on = { type = "npc_appears", selector = ["Dismantler"] }

[[boss.counters]]
id = "draxus_bulwark_count"
name = "Bulwark Spawns"
increment_on = { type = "npc_appears", selector = [
  3288145357438976,
  "Bulwark",
] }


# Entity ID:
# ═════ Timers
# Draxus escapes at HP thresholds, spawning add waves
[[boss.timer]]
id = "draxus_grenade"
name = "Grenade"
trigger = { type = "ability_cast", abilities = [3289043005603840] }
duration_secs = 12.0
color = [204, 182, 30, 255]
difficulties = ["veteran", "master"]

# -- Suppressive Fire --
# Channeled attack

[[boss.timer]]
id = "draxus_suppressive"
name = "Suppressive Fire"
trigger = { type = "ability_cast", abilities = [3289034415669248] }
duration_secs = 15.0
color = [219, 96, 28, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "draxus_escape"
name = "Draxus Escape"
alert_text = "Draxus Escape"
color = [219, 27, 24, 255]
difficulties = ["veteran", "master"]
is_alert = true
trigger = { type = "any_of", conditions = [
  { type = "boss_hp_below", hp_percent = 90.0, selector = [
    "Draxus",
  ] },
  { type = "boss_hp_below", hp_percent = 60.0, selector = [
    "Draxus",
  ] },
  { type = "boss_hp_below", hp_percent = 30.0, selector = [
    "Draxus",
  ] },
] }

[[boss.timer]]
id = "draxus_w1"
name = "Wave 1"
trigger = { type = "combat_start" }
duration_secs = 50.0
color = [33, 151, 18, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w2" }

[[boss.timer]]
id = "draxus_w2"
name = "Wave 2"
trigger = { type = "counter_reaches", counter_id = "draxus_subteroth_count", value = 1 }
duration_secs = 50.0
color = [33, 151, 18, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w3" }

[[boss.timer]]
id = "draxus_w3"
name = "Wave 3"
trigger = { type = "counter_reaches", counter_id = "draxus_dispatcher_count", value = 1 }
duration_secs = 50.0
color = [20, 136, 30, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w4" }

[[boss.timer]]
id = "draxus_w4"
name = "Wave 4"
# Entity ID: 3288136767504384
trigger = { type = "counter_reaches", counter_id = "draxus_corrupter_count", value = 1 }
duration_secs = 50.0
color = [20, 136, 22, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w5" }

[[boss.timer]]
id = "draxus_w5"
name = "Wave 5"
trigger = { type = "counter_reaches", counter_id = "draxus_dismantler_count", value = 1 }
duration_secs = 50.0
color = [20, 136, 22, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w6" }

[[boss.timer]]
id = "draxus_w6"
name = "Wave 6"
trigger = { type = "counter_reaches", counter_id = "draxus_bulwark_count", value = 1 }
duration_secs = 50.0
color = [20, 136, 26, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w7" }

[[boss.timer]]
id = "draxus_w7"
name = "Wave 7"
trigger = { type = "counter_reaches", counter_id = "draxus_dismantler_count", value = 3 }
duration_secs = 50.0
color = [20, 136, 26, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w8" }

[[boss.timer]]
id = "draxus_w8"
name = "Wave 8"
trigger = { type = "counter_reaches", counter_id = "draxus_subteroth_count", value = 13 }
duration_secs = 50.0
color = [20, 136, 26, 255]
difficulties = ["master"]
cancel_trigger = { type = "timer_started", timer_id = "draxus_w9" }

[[boss.timer]]
id = "draxus_w9"
name = "Wave 9"
trigger = { type = "counter_reaches", counter_id = "draxus_bulwark_count", value = 5 }
duration_secs = 50.0
color = [20, 136, 26, 255]
difficulties = ["master"]
cancel_trigger = { type = "counter_reaches", counter_id = "draxus_corrupter_count", value = 10 }


# -- Emergency Shielding --
# Final phase immunity - alert when applied and removed

[[boss.timer]]
id = "draxus_shield_on"
name = "Emergency Shield"
trigger = { type = "effect_applied", effects = [3321693346988296] }
is_alert = true
alert_text = "Shield Active"
color = [29, 224, 219, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "draxus_shield_off"
name = "Shield Down - BURN"
trigger = { type = "effect_removed", effects = [3321693346988296] }
is_alert = true
alert_text = "Shield Down!"
color = [33, 224, 218, 255]
difficulties = ["veteran", "master"]

# ═══════════════════════════════════════════════════════════════════════════════
# Boss 3: Grob'thok, Who Feeds the Forge
# ═══════════════════════════════════════════════════════════════════════════════
# Kite fight with lava, adds, and a magnet mechanic.
# Source: ORBS timer data

[[boss]]
id = "grobthok"
name = "Grob'thok"
difficulties = ["story", "veteran", "master"]

[[boss.entities]]
name = "Grob'thok"
ids = [3302567857618944, 3302559267684352, 3273929015689216, 3302563562651648]
is_boss = true
is_kill_target = true

[[boss.entities]]
name = "Dreadful Ugnaught"
ids = [3307678868701184]
is_boss = false

# ─── Timers ─────────────────────────────────────────────────────────────────────

# -- Pipe Smash --
# Boss smashes pipes to release lava. 60s from start, 63s after each cast.

[[boss.timer]]
id = "grobthok_pipe_smash_cs"
name = "Pipe Smash Combat Start"
display_text = "Pipe Smash"
trigger = { type = "combat_start" }
duration_secs = 60.0
color = [204, 182, 30, 255]
difficulties = ["veteran", "master"]
chains_to = "grobthok_pipe_smash"

[[boss.timer]]
id = "grobthok_pipe_smash"
name = "Pipe Smash"
trigger = { type = "ability_cast", abilities = [3307601559289856] }
duration_secs = 63.0
color = [204, 182, 30, 255]
difficulties = ["veteran", "master"]

# -- Adds --
# Spawns at 97% HP, then 25s after each spawn ability.

[[boss.timer]]
id = "grobthok_adds_hp"
name = "Adds"
trigger = { type = "boss_hp_below", hp_percent = 97.0, selector = [
  "Grob'thok",
] }
is_alert = true
alert_text = "Adds Spawning"
color = [25, 148, 13, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "grobthok_adds"
name = "Adds"
trigger = { type = "ability_cast", abilities = [3315585903493120] }
duration_secs = 25.0
color = [25, 148, 13, 255]
difficulties = ["veteran", "master"]

# -- Lava

[[boss.timer]]
id = "grobthok_lava_start"
name = "First Mining Droid"
trigger = { type = "boss_hp_below", hp_percent = 95.0, selector = [
  "Grob'thok",
] }
is_alert = true
alert_text = "Lava "
color = [224, 108, 29, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "grobthok_lava_dot"
name = "Mining Droid"
trigger = { type = "ability_cast", abilities = [3294703772499968] }
duration_secs = 30.0
color = [224, 108, 29, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "grobthok_dot_debuff"
name = "Mining Droid on Self"
trigger = { type = "effect_applied", effects = [
  3294703772500224,
], target = "local_player" }
is_alert = true
alert_text = "MINING DROID DEBUFF"
color = [224, 108, 29, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "grobthok_overhead_smash"
name = "Overhead Smash"
trigger = { type = "ability_cast", abilities = [3285993578823680] }
duration_secs = 33.0
color = [144, 24, 224, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "grobthok_roar"
name = "Roar"
trigger = { type = "ability_cast", abilities = [3285997873790976] }
duration_secs = 15.0
color = [219, 28, 28, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "grobthok_stunned"
name = "Stunned"
trigger = { type = "effect_applied", effects = [3286745198100740] }
duration_secs = 10.0
color = [33, 224, 221, 255]
difficulties = ["veteran", "master"]


#
# ═══════════════════════════════════════════════════════════════════════════════
# Boss 4: Corruptor Zero
# ═══════════════════════════════════════════════════════════════════════════════
# Droid boss with melee and ranged phases.
# Source: ORBS timer data

[[boss]]
id = "corruptor_zero"
name = "Corruptor Zero"
difficulties = ["story", "veteran", "master"]

[[boss.entities]]
name = "Corruptor Zero"
ids = [3273933310656512, 3303542815195136, 3303534225260544, 3303551405129728]
is_boss = true
is_kill_target = true

[[boss.entities]]
name = "D-13 Corruption Droid"
ids = [3282596259692544]
is_boss = false

[[boss.entities]]
name = "D-15 Corruption Droid"
ids = [3282639209365504]
is_boss = false

[[boss.timer]]
id = "corruptor_zero_ranged_adds"
name = "Ranged Adds"
trigger = { type = "npc_appears", selector = ["D-13 Corruption Droid"] }
duration_secs = 60.0
color = [27, 158, 20, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_melee_adds"
name = "Melee Adds"
trigger = { type = "npc_appears", selector = ["D-15 Corruption Droid"] }
duration_secs = 60.0
color = [27, 158, 20, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_missile_barrage"
name = "Missile Barrage"
trigger = { type = "ability_cast", abilities = [3286483205095424] }
duration_secs = 15.0
color = [35, 28, 219, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_heavy_slash"
name = "Heavy Slash"
trigger = { type = "ability_cast", abilities = [3286530449735680] }
duration_secs = 20.0
color = [219, 30, 28, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_chest_laser"
name = "Chest Laser"
trigger = { type = "ability_cast", abilities = [3285409463271424] }
duration_secs = 15.0
color = [224, 59, 212, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_beam_melee_mode"
name = "Beam (Melee Mode)"
trigger = { type = "effect_applied", effects = [3284760923209993] }
duration_secs = 60.0
color = [219, 96, 28, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_gravity_ranged_mode"
name = "Gravity (Ranged Mode)"
trigger = { type = "effect_applied", effects = [3284760923209990] }
duration_secs = 60.0
color = [219, 96, 28, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_concussion_mine"
name = "Concussion Mine"
trigger = { type = "any_of", conditions = [
  { type = "ability_cast", abilities = [
    3321882325549056,
  ] },
  { type = "ability_cast", abilities = [
    3344271990063104,
  ] },
] }
duration_secs = 21.5
color = [24, 224, 221, 255]
difficulties = ["veteran", "master"]

[[boss.timer]]
id = "corruptor_zero_gravity_field"
name = "Gravity Field"
trigger = { type = "ability_cast", abilities = [3285972103987200] }
duration_secs = 33.0
color = [204, 191, 30, 255]
difficulties = ["veteran", "master"]

#
#
# ═══════════════════════════════════════════════════════════════════════════════
# Boss 5: Dread Master Brontes
# ═══════════════════════════════════════════════════════════════════════════════
# Complex multi-phase fight with hands, fingers, orbs, and clocks.
# Source: ORBS timer data

[[boss]]
id = "brontes"
name = "Dread Master Brontes"
difficulties = ["story", "veteran", "master"]

[[boss.entities]]
name = "Dread Master Brontes"
ids = [3273937605623808, 3303538520227840, 3303529930293248, 3303547110162432]
is_boss = true
is_kill_target = true

[[boss.entities]]
name = "Right Hand of Brontes"
ids = [3275625527771136]
is_boss = true

[[boss.entities]]
name = "Left Hand of Brontes"
ids = [3277721471811584]
is_boss = true

[[boss.entities]]
name = "Hand of Brontes"
ids = [3303276527222784]
is_boss = false
[[boss.entities]]
name = "Finger of Brontes"
ids = [3275642707640320]
is_boss = false

[[boss.entities]]
name = "Energy Sphere"
ids = [3280057934020608]
is_boss = false

[[boss.entities]]
name = "Reach of Brontes"
ids = [3298281480257536]
is_boss = false

# ─── Phases ─────────────────────────────────────────────────────────────────────
